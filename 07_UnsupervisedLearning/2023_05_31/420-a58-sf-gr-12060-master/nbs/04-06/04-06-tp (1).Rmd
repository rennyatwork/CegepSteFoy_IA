---
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

**420-A58-SF - Algorithmes d'apprentissage non supervisé - Été 2020 - Spécialisation technique en Intelligence Artificielle**
MIT License - Copyright (c) 2020 Mikaël Swawola

```{r 04-07-tp-banner, echo=FALSE, fig.cap="", out.width='100%'}
knitr::include_graphics("static/04-07-tp-banner.png")
```

**Objectif: Réaliser des prédictions à l'aide du modèle ARIMA-SARIMA sur le jeu de données "electricity"**

### Librairies

```{r libraries}
# Compléter les librairies au fur et à mesure du TP ~ 2 librairies requises
library(ggplot2)
library(fpp2)
```


### Exercice 1-1
**Importez la série "electricity.dat", série mensuelle débutant en janvier 1986. Faites-en un graphique.**
```{r ex1_1}
# Votre code ici ~ 5 lignes de code
data <-read.table("../../data/electricity.dat", header=TRUE)
elec <- data
myts <- ts(elec, start=1986, frequency=12)
autoplot(myts)
```


### Exercice 1-2
**En utilisant un modèle SARIMA, faites des prévisions sur 2 ans. Vérifiez les résidus**
```{r ex1_2}
# Votre code ici ~ 7 lignes de code

fit1.arima = elec %>% auto.arima()

elec %>%
  auto.arima()  %>%
  forecast(h=24) %>%
  autoplot()

#fit1.arima <- auto.arima(h02)
checkresiduals(fit.arima)
```


### Exercice 1-3
**Tronquez fictivement les 60 dernières observations et faites des prévisions via un modèle SARIMA et une approche "ets". Afficher les prévisions SARIMA et ETS sur un même graphique.**
```{r ex1_3}
# Votre code ici ~ 10-15 lignes de code
last_60 <- tail(myts, n=60)
last_60_values <-last_60
sarima_model <- auto.arima(last_60)
sarima_forecast <-forecast (sarima_model, h=12)

# ETS forecasting
ets_model <- ets(last_60)
ets_forecast <- forecast(ets_model, h = 12)  # Forecasting for the next 12 periods

# Combine SARIMA and ETS forecasts into one data frame
combined_forecast <- data.frame(
  Time = time(sarima_forecast$mean),
  SARIMA = sarima_forecast$mean,
  ETS = ets_forecast$mean
)

# Combine SARIMA and ETS forecasts into one data frame
combined_forecast <- cbind(sarima = sarima_forecast$mean, ets = ets_forecast$mean)


# Plot the last 60 values and the forecasts
autoplot(myts) +
  autolayer(last_60_values, series = "Last 60 Values") +
  autolayer(combined_forecast, series = c("SARIMA", "ETS")) +
  xlab("Time") + ylab("Value") +
  ggtitle("Last 60 Values and Forecast Comparison")
```


```{r ex1_3}
ele.train <- window(elec, end=c(2013, 12))
ele.test <- window(elec, start=c(2014))

elec.train.ets <- ets.(elec.train, model='ZZZ')
ele.train.arima <- auto.arima(elec.train.ets)

falec.train.ets <- forecast(elec.train.ets, h=60)

elec.test.ets <- ets.(elec.train, model='ZZZ')
```


### Exercice 1-4
**Comparez l’efficacité prévisionelle des deux approches.**
```{r ex1_4}
# Votre code ici ~ 2 lignes de code
```